"use strict";(self["webpackChunkweek7_hw_dashboard"]=self["webpackChunkweek7_hw_dashboard"]||[]).push([[228],{5228:function(e,t,l){l.r(t),l.d(t,{default:function(){return ze}});var d=l(3396),a=l(7139);const r=(0,d._)("h2",{class:"text-center"},"訂單",-1),s={class:"container"},o={class:"row py-3"},n={class:"col"},i={class:"table mt-4"},u=(0,d._)("thead",null,[(0,d._)("tr",null,[(0,d._)("th",{width:"120"},"購買時間"),(0,d._)("th",{width:"120"},"Email"),(0,d._)("th",{width:"120"},"購買款項"),(0,d._)("th",{width:"120"},"應付金額"),(0,d._)("th",{width:"120"},"是否付款"),(0,d._)("th",{width:"120"},"編輯")])],-1),c={id:"productList"},p={class:"list-unstyled"},h={class:"text-secondary"},_={key:0,class:"text-success"},m={key:1,class:"text-danger"},b={class:"btn-group"},w=["onClick"],g=["onClick"],O=(0,d.Uk)(" 本頁面有 "),y={id:"productCount"},v=(0,d.Uk)(" 筆訂單 ");function f(e,t,l,f,k,M){const D=(0,d.up)("VueLoading"),x=(0,d.up)("PaginationView"),z=(0,d.up)("OrderModal"),$=(0,d.up)("DeleteOrderModal");return(0,d.wg)(),(0,d.iD)(d.HY,null,[(0,d.Wm)(D,{active:k.isLoading},null,8,["active"]),r,(0,d._)("div",s,[(0,d._)("div",o,[(0,d._)("div",n,[(0,d._)("table",i,[u,(0,d._)("tbody",c,[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(k.orders,(e=>((0,d.wg)(),(0,d.iD)("tr",{key:e.id},[(0,d._)("td",null,(0,a.zw)(new Date(1e3*e.create_at).toLocaleDateString()),1),(0,d._)("td",null,(0,a.zw)(e.user.email),1),(0,d._)("td",null,[(0,d._)("ul",p,[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(e.products,((e,t)=>((0,d.wg)(),(0,d.iD)("li",{key:t},[(0,d._)("span",h,(0,a.zw)(e.product.title),1),(0,d.Uk)(" 數量 : "+(0,a.zw)(e.qty)+" "+(0,a.zw)(e.product.unit),1)])))),128))])]),(0,d._)("td",null,(0,a.zw)(e.total),1),(0,d._)("td",null,[e.is_paid?((0,d.wg)(),(0,d.iD)("span",_,"已付款")):((0,d.wg)(),(0,d.iD)("span",m,"未付款"))]),(0,d._)("td",null,[(0,d._)("div",b,[(0,d._)("button",{type:"button",class:"btn btn-outline-success btn-sm",onClick:t=>M.openModal("edit",e)}," 檢視 ",8,w),(0,d._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:t=>M.openModal("delete",e)}," 刪除 ",8,g)])])])))),128))])]),(0,d._)("p",null,[O,(0,d._)("span",y,(0,a.zw)(k.orders.length),1),v])])]),(0,d.Wm)(x,{pages:k.pagination,onEmitGetPage:M.getAllOrders},null,8,["pages","onEmitGetPage"]),(0,d.Wm)(z,{"order-mod":k.tempOrder,onUpdateOrder:M.updateOrderState,ref:"orderModalRef"},null,8,["order-mod","onUpdateOrder"]),(0,d.Wm)($,{"delete-order-item":k.tempOrder,onGetOrders:M.getAllOrders,ref:"delModalRef"},null,8,["delete-order-item","onGetOrders"])])],64)}var k=l(6567),M=l(9242);const D={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modalRef"},x={class:"modal-dialog modal-xl",role:"document"},z={class:"modal-content border-0"},$=(0,d._)("div",{class:"modal-header bg-dark text-white"},[(0,d._)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,d._)("span",null,"訂單細節")]),(0,d._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),C={class:"modal-body"},L={class:"row"},S={class:"col-md-4"},P=(0,d._)("h3",null,"用戶資料",-1),R={class:"table"},N={key:0},U=(0,d._)("th",{style:{width:"100px"}},"姓名",-1),A=(0,d._)("th",null,"Email",-1),E=(0,d._)("th",null,"電話",-1),G=(0,d._)("th",null,"地址",-1),H={class:"col-md-8"},J=(0,d._)("h3",null,"訂單細節",-1),V={class:"table"},W=(0,d._)("th",{style:{width:"100px"}},"訂單編號",-1),Y=(0,d._)("th",null,"下單時間",-1),Z=(0,d._)("th",null,"付款時間",-1),q={key:0},K={key:1},I=(0,d._)("th",null,"付款狀態",-1),j={key:0,class:"text-success"},B={key:1,class:"text-muted"},F=(0,d._)("th",null,"總金額",-1),Q=(0,d._)("h3",null,"選購商品",-1),T={class:"table"},X=(0,d._)("thead",null,[(0,d._)("tr")],-1),ee={class:"text-end"},te={class:"d-flex justify-content-end"},le={class:"form-check"},de={class:"form-check-label",for:"flexCheckDefault"},ae={key:0},re={key:1},se={class:"modal-footer"},oe=(0,d._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ne(e,t,l,r,s,o){return(0,d.wg)(),(0,d.iD)("div",D,[(0,d._)("div",x,[(0,d._)("div",z,[$,(0,d._)("div",C,[(0,d._)("div",L,[(0,d._)("div",S,[P,(0,d._)("table",R,[s.tempOrder.user?((0,d.wg)(),(0,d.iD)("tbody",N,[(0,d._)("tr",null,[U,(0,d._)("td",null,(0,a.zw)(s.tempOrder.user.name),1)]),(0,d._)("tr",null,[A,(0,d._)("td",null,(0,a.zw)(s.tempOrder.user.email),1)]),(0,d._)("tr",null,[E,(0,d._)("td",null,(0,a.zw)(s.tempOrder.user.tel),1)]),(0,d._)("tr",null,[G,(0,d._)("td",null,(0,a.zw)(s.tempOrder.user.address),1)])])):(0,d.kq)("",!0)])]),(0,d._)("div",H,[J,(0,d._)("table",V,[(0,d._)("tbody",null,[(0,d._)("tr",null,[W,(0,d._)("td",null,(0,a.zw)(s.tempOrder.id),1)]),(0,d._)("tr",null,[Y,(0,d._)("td",null,(0,a.zw)(new Date(1e3*s.tempOrder.create_at).toLocaleDateString()),1)]),(0,d._)("tr",null,[Z,(0,d._)("td",null,[s.tempOrder.paid_date?((0,d.wg)(),(0,d.iD)("span",q,(0,a.zw)(new Date(1e3*s.tempOrder.paid_date).toLocaleDateString()),1)):((0,d.wg)(),(0,d.iD)("span",K,"時間不正確"))])]),(0,d._)("tr",null,[I,(0,d._)("td",null,[s.tempOrder.is_paid?((0,d.wg)(),(0,d.iD)("strong",j,"已付款")):((0,d.wg)(),(0,d.iD)("span",B,"尚未付款"))])]),(0,d._)("tr",null,[F,(0,d._)("td",null,(0,a.zw)(s.tempOrder.total),1)])])]),Q,(0,d._)("table",T,[X,(0,d._)("tbody",null,[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(s.tempOrder.products,(e=>((0,d.wg)(),(0,d.iD)("tr",{key:e.id},[(0,d._)("th",null,(0,a.zw)(e.product.title),1),(0,d._)("td",null,(0,a.zw)(e.qty)+" / "+(0,a.zw)(e.product.unit),1),(0,d._)("td",ee,(0,a.zw)(e.final_total),1)])))),128))])]),(0,d._)("div",te,[(0,d._)("div",le,[(0,d.wy)((0,d._)("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":t[0]||(t[0]=e=>s.tempOrder.is_paid=e)},null,512),[[M.e8,s.tempOrder.is_paid]]),(0,d._)("label",de,[s.tempOrder.is_paid?((0,d.wg)(),(0,d.iD)("span",ae,"已付款")):((0,d.wg)(),(0,d.iD)("span",re,"未付款"))])])])])])]),(0,d._)("div",se,[oe,(0,d._)("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=t=>e.$emit("update-order",s.tempOrder))}," 修改付款狀態 ")])])])],512)}var ie=l(7972),ue=l.n(ie),ce={data(){return{orderModal:{},tempOrder:{},isPaid:!1}},props:{orderMod:{}},emits:["update-order"],watch:{orderMod(){this.tempOrder=this.orderMod}},methods:{open(){this.orderModal.show()},close(){this.orderModal.hide()}},mounted(){this.orderModal=new(ue())(this.$refs.modalRef,{keyboard:!1})}},pe=l(89);const he=(0,pe.Z)(ce,[["render",ne]]);var _e=he;const me={id:"delProductModal",ref:"delModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},be={class:"modal-dialog"},we={class:"modal-content border-0"},ge=(0,d.uE)('<div class="modal-header bg-danger text-white"><h5 id="delProductModalLabel" class="modal-title"><span>刪除訂單</span></h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"> 是否刪除 <strong class="text-danger"></strong> 該筆訂單(刪除後將無法恢復)。 </div>',2),Oe={class:"modal-footer"},ye=(0,d._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ve(e,t,l,a,r,s){return(0,d.wg)(),(0,d.iD)("div",me,[(0,d._)("div",be,[(0,d._)("div",we,[ge,(0,d._)("div",Oe,[ye,(0,d._)("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=(...e)=>s.deleteOrder&&s.deleteOrder(...e))}," 確認刪除 ")])])])],512)}var fe={data(){return{delOrderModal:""}},props:["deleteOrderItem"],methods:{open(){this.delOrderModal.show()},close(){this.delOrderModal.hide()},deleteOrder(){this.$http.delete(`https://vue3-course-api.hexschool.io/v2/api/steven1220/admin/order/${this.deleteOrderItem.id}`).then((()=>{this.$emit("get-orders"),this.close()})).catch((e=>{console.log(e.data)}))}},mounted(){this.delOrderModal=new(ue())(this.$refs.delModal,{keyboard:!1})}};const ke=(0,pe.Z)(fe,[["render",ve]]);var Me=ke,De={components:{PaginationView:k.Z,OrderModal:_e,DeleteOrderModal:Me},data(){return{orders:[],pagination:{},tempOrder:{},isNew:!1,isLoading:!1}},methods:{getAllOrders(e=1){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/v2/api/steven1220/admin/orders/?page=${e}`;this.$http.get(t).then((e=>{this.orders=e.data.orders,this.pagination=e.data.pagination,this.isLoading=!1})).catch((e=>{console.log(e.data)}))},openModal(e,t){console.log(e,t),"edit"==e?(this.tempOrder=JSON.parse(JSON.stringify(t)),this.$refs.orderModalRef.open(),this.isNew=!1):"delete"==e&&(this.tempOrder=JSON.parse(JSON.stringify(t)),this.$refs.delModalRef.open())},updateOrderState(e){const t=`https://vue3-course-api.hexschool.io/v2/api/steven1220/admin/order/${e.id}`,l={is_paid:e.is_paid};this.$http.put(t,{data:l}).then((e=>{this.getAllOrders(),this.$httpMessageState(e,"已更新付款狀態"),this.$refs.orderModalRef.close()})).catch((e=>{console.log(e.data)}))}},mounted(){this.getAllOrders()}};const xe=(0,pe.Z)(De,[["render",f]]);var ze=xe}}]);
//# sourceMappingURL=228.e086fe75.js.map